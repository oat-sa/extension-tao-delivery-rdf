{"version":3,"sources":["routes.js","DeliveryMgmt/editDelivery.js","DeliveryMgmt/testtaker.js","DeliveryMgmt/wizard.js"],"names":["define","DeliveryMgmt","actions","editDelivery","excludeTesttaker","wizard","$","helpers","start","click","delivery","this","data","load","_url","uri","prepend","modal","__","module","section","feedback","switchList","target","current","parent","attr","append","scrollIntoView","timeout","$search","$list","liveSearch","pattern","val","clearTimeout","setTimeout","filterList","RegExp","regex","list","children","each","index","element","text","match","hide","show","excluded","push","assemblyUri","ajax","url","type","JSON","stringify","dataType","success","response","saved","loadContentBlock","keyup","siblings","filterFactory","urlUtils","Promise","provider","resolve","reject","route","q","page","done","tests","Error","fail","$filterContainer","$formElement","placeholder","width","quietMillis","label","on","test","params","then","catch","err","error","render"],"mappings":"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","file":"routes.js","sourcesContent":["/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2014-2017 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\n *\n *\n */\n\n//@see http://forge.taotesting.com/projects/tao/wiki/Front_js\ndefine('taoDeliveryRdf/controller/routes',[],function(){\n    'use strict';\n\n    return {\n        'DeliveryMgmt': {\n            'actions' : {\n                'editDelivery'     : 'controller/DeliveryMgmt/editDelivery',\n                'excludeTesttaker' : 'controller/DeliveryMgmt/testtaker',\n                'wizard'           : 'controller/DeliveryMgmt/wizard'\n            }\n        }\n    };\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2013 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\n *\n *\n */\ndefine('taoDeliveryRdf/controller/DeliveryMgmt/editDelivery',['jquery', 'helpers', 'ui/modal'],\nfunction ($, helpers) {\n\t'use strict';\n\t\n\treturn {\n        start : function(){\n            $('#exclude-btn').click(function() {\n            \tvar delivery = $(this).data('delivery');\n        \t    $('#testtaker-form').load(helpers._url('excludeTesttaker', 'DeliveryMgmt', 'taoDeliveryRdf', {'uri' : delivery}), function() {\n                    $('body').prepend($('#modal-container'));\n                    $('#testtaker-form').modal();\n                });\n        \t});\n        }\n\t}\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2013 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\n *\n *\n */\ndefine('taoDeliveryRdf/controller/DeliveryMgmt/testtaker',['jquery', 'i18n', 'helpers', 'module', 'layout/section', 'ui/feedback'], \nfunction ($, __, helpers, module, section, feedback) {\n    'use strict';\n\n\tfunction switchList() {\n\t\tvar current = $(this).parent().attr('id');\n        var target; \n\t\tif (current == 'excludedList') {\n\t\t\ttarget = $('#assignedList'); \n\t\t} else if (current == 'assignedList') {\n\t\t\ttarget = $('#excludedList');\n\t\t}\n\t\tif (typeof target !== 'undefined') {\n\t\t\ttarget.append(this);\n\t\t\tthis.scrollIntoView();\n\t\t}\n\t}\n\t\n\tvar $search = $('#tt-filter');\n    var $list   = $('#assignedList');\n    var timeout;\n    \n    var liveSearch = function(){\n        var pattern = $search.val();\n        clearTimeout(timeout);\n        timeout = setTimeout(function(){\n        \tfilterList(new RegExp(pattern), $list);\n        }, 300);\n    };\n    \n    var filterList = function(regex, list) {\n    \tlist.children().each(function(index, element) {\n    \t\tif ($(element).text().match(regex) === null) {\n    \t\t\t$(element).hide();\n    \t\t} else {\n    \t\t\t$(element).show();\n    \t\t}\n    \t});\n    };\n\t\n    return {\n        start : function(){\n\t        $('#save-tt').click(function() {\n\t        \tvar excluded = [];\n\t        \t$('#excludedList > li').each(function(index) {\n\t        \t\texcluded.push($(this).data('uri'));\n\t        \t});\n\t        \tvar assemblyUri = $('input[name=\"assemblyUri\"]').val();\n\t        \t$.ajax({\n\t        \t\turl: helpers._url('saveExcluded', 'DeliveryMgmt', 'taoDeliveryRdf'),\n\t\t\t\t\ttype: \"POST\",\n\t\t\t\t\tdata: {\n\t\t\t\t\t\turi: assemblyUri,\n\t\t\t\t\t\texcluded: JSON.stringify(excluded)\n\t\t\t\t\t},\n\t\t\t\t\tdataType: 'json',\n\t\t\t\t\tsuccess: function(response) {\n\t\t\t\t\t\tif (response.saved) {\n                            feedback().success(__('Selection saved successfully'));\n                            section.loadContentBlock(helpers._url('editDelivery', 'DeliveryMgmt', 'taoDeliveryRdf'), {uri: assemblyUri});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t        });\n        \t$('#assignedList > li').click(switchList);\n        \t$('#excludedList > li').click(switchList);\n        \t\n        \t$('#close-tt').click(function() {\n        \t\t$('#testtaker-form').modal('close');\n        \t});\n                \n            //trigger the search on keyp and on the magnifer button click\n            $search.keyup(liveSearch).siblings('.ctrl').click(liveSearch);\n        \t\n        }\n    };\n});\n\n\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2017 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\n *\n */\ndefine('taoDeliveryRdf/controller/DeliveryMgmt/wizard',['jquery', 'i18n', 'ui/filter', 'ui/feedback', 'util/url', 'core/promise'], function ($, __, filterFactory, feedback, urlUtils, Promise) {\n    'use strict';\n\n    var provider = {\n\n        /**\n         * List available tests\n         * @returns {Promise}\n         */\n        list: function list(data) {\n            return new Promise(function (resolve, reject) {\n                $.ajax({\n                    url: urlUtils.route('getAvailableTests', 'DeliveryMgmt', 'taoDeliveryRdf'),\n                    data: {\n                        q: data.q,\n                        page: data.page\n                    },\n                    type: 'GET',\n                    dataType: 'JSON'\n                }).done(function (tests) {\n                    if (tests) {\n                        resolve(tests);\n                    } else {\n                        reject(new Error(__('Unable to load tests')));\n                    }\n                }).fail(function () {\n                    reject(new Error(__('Unable to load tests')));\n                });\n            });\n        }\n    };\n\n\n    return {\n        start: function () {\n            var $filterContainer = $('.test-select-container');\n            var $formElement = $('#test');\n\n            filterFactory($filterContainer, {\n                placeholder: __('Select the test you want to publish to the test-takers'),\n                width: '64%',\n                quietMillis: 1000,\n                label: __('Select the test')\n            }).on('change', function (test) {\n                $formElement.val(test);\n            }).on('request', function (params) {\n                provider\n                    .list(params.data)\n                    .then(function (tests) {\n                        params.success(tests);\n                    })\n                    .catch(function (err) {\n                        params.error(err);\n                        feedback().error(err);\n                    });\n            }).render('<%= text %>');\n        }\n    };\n});\n\n\n\n"]}